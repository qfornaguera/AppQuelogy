package com.example.appqueology;

import java.util.ArrayList;

import android.app.Activity;
import android.app.AlertDialog;
import android.content.DialogInterface;
import android.content.Intent;
import android.util.Log;
import android.view.DragEvent;
import android.view.View;
import android.view.View.OnDragListener;
import android.widget.RelativeLayout;

public class OnDragSladingDrawer implements OnDragListener{
	boolean exited = false;
	@Override
	public boolean onDrag(View v, DragEvent event) {
		Artifact touchedArtifact = (Artifact) event.getLocalState();
		
		switch (event.getAction()) {
			case DragEvent.ACTION_DRAG_STARTED://when the artifact launches its drag action
			  break;
			case DragEvent.ACTION_DRAG_ENTERED:
			  break;
			  
			case DragEvent.ACTION_DRAG_EXITED:
				exited = true;
			  break;
			case DragEvent.ACTION_DROP://when the artifact is droped somewhere
				View owner = (View)touchedArtifact.getParent();
				if(v != owner){//if the drag and drop started at a SlideDrawer Artifact
					Log.v("if: "+(v.getX()+event.getX()), "board: "+v.getX()+" event: "+event.getX());
					Log.v("if: "+(v.getX()+(event.getX()/v.getScaleX())), "board: "+v.getX()+" event: "+(event.getX()/v.getScaleX()));
					if(exited){//Check if it has been dropped on the board
						Artifact square = new Artifact(v.getContext());//then create a new Artifact at the main frame where it was dropped
						square.setBackgroundResource(R.drawable.anfora);
				        RelativeLayout Rel = (RelativeLayout)v.getParent();
				        RelativeLayout graph = (RelativeLayout) Rel.findViewById(R.id.graph);
				        graph.addView(square,100,100);
				        square.setPrevWidth(100);
				        square.setPrevHeight(100);
				        square.setX(event.getX()-50);
				        square.setY(event.getY()-50);
				        square.setTag("node");
				        square.setId(Global.ID);
				        Global.ID++;
				        square.seekFather(Rel);
				        Utility.recalculateLines(Rel);
				        touchedArtifact.setBackgroundResource(R.drawable.anfora);
				        exited = false;
					}else{//else 
						touchedArtifact.setBackgroundResource(R.drawable.anfora);
					}

					View slideDrawer = (View)owner.getParent();//ensure the SlideDrawer overlaps all the views
					slideDrawer.bringToFront();
				}
			  break;
			case DragEvent.ACTION_DRAG_ENDED:
			  default:
			  break;
			  
			  
		}
		return true;
	}

}
